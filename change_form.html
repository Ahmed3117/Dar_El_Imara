{% extends "admin/change_form.html" %}

{% block content %}
    {{ block.super }}
    <style>
        .column-sub_category_detail{
            max-width:50%;
        }
    </style>


<script>
var all_select_elements = document.querySelectorAll('[id^="id_expectedprojectcosts_set-"][id*="-main_category_detail"]');
var new_select_element = all_select_elements[all_select_elements.length - 1];

var last_select_element = all_select_elements[all_select_elements.length - 2];
var last_select_element_id = last_select_element.id.split('-')[1];
console.log("cccccccccc")
console.log(last_select_element_id)
       

// new_select_element.value = last_select_element.value;
var new_one = document.getElementById('id_expectedprojectcosts_set-' + last_select_element_id + '-main_category_detail');
console.log(new_one)
console.log('new_one')
for (var i = 0; i < last_select_element.options.length; i++) {
  if (last_select_element.options[i].selected) {
    new_select_element.options[i].selected = true;
  }
}
</script>


    <script>
        




        // var addRow = document.querySelectorAll('.add-row');
        // console.log(addRow)
        // var addAnotherLink = addRow.querySelector('td');
        


        // document.body.addEventListener('change', function () {
     
            
        // });
    

        



        function showCategoryWorkers(event) {
            var rowId = event.target.id.split('-')[1];
            var type = this.value;
            if (type) {
                var id_sub_category_detail = document.getElementById('id_expectedprojectcosts_set-' + rowId + '-sub_category_detail');
                fetch('/get_category_subs/?category=' + type)
                    .then(response => response.json())
                    .then(data => {
                        var initialValue = document.getElementById('id_expectedprojectcosts_set-' + rowId + '-sub_category_detail').value;
    
                        // Clear the category select menu
                        id_sub_category_detail.innerHTML = '';
    
                        // Add the new options to the category select menu
                        data.forEach(function (item) {
                            var option = document.createElement('option');
                            option.value = item.id;
                            option.text = item.sub_category;
                            id_sub_category_detail.appendChild(option);
                            id_sub_category_detail.value = initialValue;
                        });
                    });
            }
        }
    
        // Attach event listener to a common parent element using event delegation
        document.body.addEventListener('change', function (event) {
            
            var targetId = event.target.id;
    
            if (targetId && targetId.includes('-main_category_detail')) {
                showCategoryWorkers.call(event.target, event);
            }
        });
    
        // Trigger the event for existing elements
        var selectElements = document.querySelectorAll('[id*="id_expectedprojectcosts_set-"][id*="-main_category_detail"]');
        selectElements.forEach(function (ele) {
            showCategoryWorkers.call(ele, { target: ele });
        });
    
        function showSubCategories(event) {
            console.log('llllllllllll');
    
            var rowId = event.target.id.split('-')[1];
            var type = this.value;
    
            if (type) {
                var id_sub_category_detail = document.getElementById('id_projectkhamatcosts_set-' + rowId + '-sub_category_detail');
    
                fetch('/get_category_subs/?category=' + type)
                    .then(response => response.json())
                    .then(data => {
                        var initialValue = document.getElementById('id_projectkhamatcosts_set-' + rowId + '-sub_category_detail').value;
                        // Clear the category select menu
                        id_sub_category_detail.innerHTML = '';
    
                        // Add the new options to the category select menu
                        data.forEach(function (item) {
                            var option = document.createElement('option');
                            option.value = item.id;
                            option.text = item.sub_category;
                            id_sub_category_detail.appendChild(option);
                            id_sub_category_detail.value = initialValue;
                        });
                    });
            }
        }
    
        // Attach event listener to a common parent element using event delegation
        document.body.addEventListener('change', function (event) {
            
            var targetId = event.target.id;
    
            if (targetId && targetId.includes('-main_category_detail')) {
                showSubCategories.call(event.target, event);
            }
        });
    
        // Trigger the event for existing elements
        var selectElements = document.querySelectorAll('[id*="id_projectkhamatcosts_set-"][id*="-main_category_detail"]');
        selectElements.forEach(function (ele) {
            showSubCategories.call(ele, { target: ele });
        });


        function showSubCategoriesforWorkersReserves(event) {
            console.log('llllllllllll');
    
            var rowId = event.target.id.split('-')[1];
            var type = this.value;
    
            if (type) {
                var id_sub_category_detail = document.getElementById('id_projectworkersreserves_set-' + rowId + '-sub_category_detail');
    
                fetch('/get_category_subs/?category=' + type)
                    .then(response => response.json())
                    .then(data => {
                        var initialValue = document.getElementById('id_projectworkersreserves_set-' + rowId + '-sub_category_detail').value;
                        // Clear the category select menu
                        id_sub_category_detail.innerHTML = '';
    
                        // Add the new options to the category select menu
                        data.forEach(function (item) {
                            var option = document.createElement('option');
                            option.value = item.id;
                            option.text = item.sub_category;
                            id_sub_category_detail.appendChild(option);
                            id_sub_category_detail.value = initialValue;
                        });
                    });
            }
        }
    
        // Attach event listener to a common parent element using event delegation
        document.body.addEventListener('change', function (event) {
            var targetId = event.target.id;
    
            if (targetId && targetId.includes('-main_category_detail')) {
                showSubCategoriesforWorkersReserves.call(event.target, event);
            }
        });
    
        // Trigger the event for existing elements
        var selectElements = document.querySelectorAll('[id*="id_projectworkersreserves_set-"][id*="-main_category_detail"]');
        selectElements.forEach(function (ele) {
            showSubCategories.call(ele, { target: ele });
        });




        
    </script>

    
{% endblock %}
